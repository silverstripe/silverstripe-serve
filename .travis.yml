language: php

dist: bionic

matrix:
  fast_finish: true
  include:
    - php: 7.4
      env: PHPUNIT_TEST=1 PHPCS_TEST=1
    - php: 8.0
      env: PHPUNIT_TEST=1
    - php: 8.1
      env: PHPUNIT_TEST=1

before_script:
  - phpenv rehash
  - export PATH=~/.composer/vendor/bin:$PATH
  - composer validate
  - if [[ $PHPCS_TEST ]]; then composer require squizlabs/php_codesniffer:^3 --no-update --prefer-dist --dev; fi
  - composer require --prefer-dist --no-update silverstripe/recipe-core:4.x-dev
  - composer install --prefer-dist

script:
 - if [[ $PHPUNIT_TEST ]]; then vendor/bin/phpunit; fi
 - if [[ $PHPCS_TEST ]]; then composer run-script lint; fi
